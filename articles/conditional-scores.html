<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conditional Scores and Constraints • adoptr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Conditional Scores and Constraints">
<meta property="og:description" content="adoptr">
<meta property="og:image" content="https://kkmann.github.io/adoptr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adoptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/adoptr.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/working-with-priors.html">Working with Priors</a>
    </li>
    <li>
      <a href="../articles/conditional-scores.html">Conditional Scores</a>
    </li>
    <li>
      <a href="../articles/composite-scores.html">Composite Scores</a>
    </li>
    <li>
      <a href="../articles/defining-new-scores.html">Definining New Scores</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkmann/adoptr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Conditional Scores and Constraints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kkmann/adoptr/blob/master/vignettes/conditional-scores.Rmd"><code>vignettes/conditional-scores.Rmd</code></a></small>
      <div class="hidden name"><code>conditional-scores.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">adoptr</span>)</pre></body></html></div>
<div id="unconditional-scores-in-adoptr" class="section level2">
<h2 class="hasAnchor">
<a href="#unconditional-scores-in-adoptr" class="anchor"></a>(Un)conditional Scores in <strong>adoptr</strong>
</h2>
<p>There are two fundamental ways of scoring a two-stage design: First, one may assess the performance before observing any data, i.e., at the planning stage. Classical examples for such scores would be power, type-one-error rate, or expected sample size. There is, however, a second perspective. After observing the stage-one outcome, one might be inclined to consider conditional properties of a design. The most prominent example being conditional power (probability to reject the null under the alternative given stage-one outcome). We consider the following example design</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">design</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/TwoStageDesign-class.html">TwoStageDesign</a></span>(
    <span class="kw">n1</span>        <span class="kw">=</span> <span class="fl">100</span>,
    <span class="kw">c1f</span>       <span class="kw">=</span> <span class="fl">.0</span>,
    <span class="kw">c1e</span>       <span class="kw">=</span> <span class="fl">2.0</span>,
    <span class="kw">n2_pivots</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">150</span>, <span class="fl">5</span>),
    <span class="kw">c2_pivots</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fl">1</span> + <span class="kw pkg">adoptr</span><span class="kw ns">:::</span><span class="fu">GaussLegendreRule</span>(<span class="fl">5</span>)$<span class="no">nodes</span>, <span class="kw">function</span>(<span class="no">x</span>) -<span class="no">x</span> + <span class="fl">2</span>)
)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">design</span>)</pre></body></html></div>
<p><img src="conditional-scores_files/figure-html/define-design-1.png" width="672"></p>
<p>In adoptr, scores are instances of their respective score class. The most important ones are: <code>ConditionalScore</code>, <code>UnconditionalScore</code>, and <code>IntegralScore</code>. An object of class <code>ConditionalScore</code> can evaluate a design for a particular stage-one outcome. A <code>ConditionalScore</code> is a function <span class="math inline">\(s(\mathcal{D}, x_1)\)</span> evaluating a design <span class="math inline">\(\mathcal{D}\)</span> at a stage-one outcome <span class="math inline">\(X_1 = x_1\)</span>. Some conditional scores might depend on the data distribution (conditional power) others do not (conditional sample size). Conditional score evaluation is completely vectorized:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">uniform_prior</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ContinuousPrior-class.html">ContinuousPrior</a></span>(
  <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>)) + <span class="fl">1</span>/<span class="fl">.2</span>,
  <span class="kw">support</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.3</span>, <span class="fl">.5</span>)
)

<span class="no">cp</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span>(<span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="no">uniform_prior</span>)
<span class="no">css</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ConditionalSampleSize</a></span>()

<span class="no">x1</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">.5</span>, <span class="fl">1</span>)
<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">cp</span>, <span class="no">design</span>, <span class="no">x1</span>)
<span class="co">#&gt; [1] 0.8312538 0.9303985 0.9772962</span>
<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">css</span>, <span class="no">design</span>, <span class="no">x1</span>)
<span class="co">#&gt; [1] 250 250 250</span></pre></body></html></div>
<p>Conditional scores can also be plotted directly for a given design by including them in the <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> call.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">design</span>, <span class="st">"Conditional Power"</span> <span class="kw">=</span> <span class="no">cp</span>)</pre></body></html></div>
<p><img src="conditional-scores_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Any conditional score can be integrated with respect to a prior and data distribution to obtain an unconditional score. Note that for conditional scores which depend on a specification of these distributions (e.g., conditional power) these arguments must be consistent! The resulting score is of class <code>IntegralScore</code>, a specific subclass of <code>UnconditionalScore</code> and evaluates designs independent of a particular <span class="math inline">\(x_1\)</span>, i.e., unconditionally</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/Scores.html">expected</a></span>(<span class="no">cp</span>, <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="no">uniform_prior</span>)
<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">ep</span>, <span class="no">design</span>)
<span class="co">#&gt; [1] 0.989392</span></pre></body></html></div>
<p>Power at a point alternative can be obtained by forming the expected value with respect to a point prior. For convenience, we include a constructor for power directly, e.g., both variants are equivalent and give power at <span class="math inline">\(0.4\)</span>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">power1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/Scores.html">expected</a></span>(
  <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span>(<span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="fl">.4</span>, <span class="fl">1.0</span>)),
  <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="fl">.4</span>, <span class="fl">1.0</span>)
)
<span class="no">power2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span>(<span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="fl">.4</span>, <span class="fl">1.0</span>))

<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">power1</span>, <span class="no">design</span>)
<span class="co">#&gt; [1] 0.9967857</span>
<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">power2</span>, <span class="no">design</span>)
<span class="co">#&gt; [1] 0.9967857</span></pre></body></html></div>
<p>Similarly, <code>ExpectedSampleSize</code> is a shorthand constructor for expected conditional sample size, i.e., the overall expected sample size:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ess1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/Scores.html">expected</a></span>(<span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ConditionalSampleSize</a></span>(), <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="no">uniform_prior</span>)
<span class="no">ess2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ExpectedSampleSize</a></span>(<span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="no">uniform_prior</span>)

<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">ess1</span>, <span class="no">design</span>)
<span class="co">#&gt; [1] 134.9135</span>
<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">ess2</span>, <span class="no">design</span>)
<span class="co">#&gt; [1] 134.9135</span></pre></body></html></div>
</div>
<div id="conditional-constraints" class="section level2">
<h2 class="hasAnchor">
<a href="#conditional-constraints" class="anchor"></a>Conditional Constraints</h2>
<p>The same syntax for constraint specification as for unconditional constraints (power etc.) can be used for conditional scores (e.g. conditional power) as well. Currently, these constraints apply to the continuation area only. E.g.,</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">cp</span> <span class="kw">&gt;=</span> <span class="fl">0.7</span>
<span class="co">#&gt; -Pr[x2&gt;=c2(x1)|x1]&lt;Normal&lt;two-armed&gt;;ContinuousPrior&lt;[0.3,0.5]&gt;&gt; (x1) &lt;= -0.7 for x1 in [c1f,c1e]</span></pre></body></html></div>
<p>imposes a constraint on the minimal conditional power upon continuation. Inter-score comparisons are also supported, e.g.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">cp</span> <span class="kw">&gt;=</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span>(<span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(), <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="fl">0</span>, <span class="fl">1</span>))
<span class="co">#&gt; Pr[x2&gt;=c2(x1)|x1]&lt;Normal&lt;two-armed&gt;;PointMass&lt;0.00&gt;&gt;  - Pr[x2&gt;=c2(x1)|x1]&lt;Normal&lt;two-armed&gt;;ContinuousPrior&lt;[0.3,0.5]&gt;&gt; (x1) &lt;= 0 for x1 in [c1f,c1e]</span></pre></body></html></div>
<p>Would enforce that conditional power is always larger than conditional error.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin Kunzmann, Maximilian Pilz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f5b8253ef131d8de31a2e0e075678ba8',
    indexName: 'adoptr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
