<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with adoptr • adoptr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Get started with adoptr">
<meta property="og:description" content="adoptr">
<meta property="og:image" content="https://kkmann.github.io/adoptr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adoptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/adoptr.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/working-with-priors.html">Working with Priors</a>
    </li>
    <li>
      <a href="../articles/conditional-scores.html">Conditional Scores</a>
    </li>
    <li>
      <a href="../articles/composite-scores.html">Composite Scores</a>
    </li>
    <li>
      <a href="../articles/defining-new-scores.html">Definining New Scores</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkmann/adoptr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with adoptr</h1>
            
            <h4 class="date">2020-06-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkmann/adoptr/blob/master/vignettes/adoptr.Rmd"><code>vignettes/adoptr.Rmd</code></a></small>
      <div class="hidden name"><code>adoptr.Rmd</code></div>

    </div>

    
    
<div id="two-stage-designs-for-clinical-trials" class="section level2">
<h2 class="hasAnchor">
<a href="#two-stage-designs-for-clinical-trials" class="anchor"></a>Two-stage designs for clinical trials</h2>
<p>In prospectively planned confirmatory clinical trials there has been a long-standing debate about the merits of allowing pre-planned interim analyses to stop or modify an ongoing trial, cf. <a href="https://onlinelibrary.wiley.com/doi/pdf/10.1002/sim.6472">BAUER <em>et al.</em>, 2016</a>. It is common consensus that such two-stage designs should still maintain strict control of the maximal type one error rate despite the data dependent decision at the interim analysis. Most authors use combination function approaches to combine either the independent p values or test statistics from the respective stages. Doing so with pre-specified weights maintains the type one error rate control.</p>
<p>With <strong>adoptr</strong> we provide tools to explore optimal two-stage designs for one or two-arm clinical trials with (asymptotically) normally distributed and stage-wise independent test statistics. In <a href="https://doi.org/10.1002/sim.8291">Pilz <em>et al.</em>, 2019</a>, it was argued that such techniques are not necessary, in fact, that they are counter-productive, since the pre-specified weights might be sub-optimal. Instead, one may see the problem of defining an optimal two-stage designs as a variational problem to find the optimal configuration <span class="math display">\[
\mathcal{D}:=\big(n_1, c_1^e, c_1^f, n_2(\cdot), c_2(\cdot)\big)
\]</span> directly for a given objective function and potentially a set of constraints. The relaxation of this mixed-integer problem to the real numbers can then be solved with standard methods from analysis. E.g., one could construct an implicit solution by solving the corresponding Euler-Lagrange equation for given first-stage and then find an optimal first-stage configuration, cf. <a href="https://doi.org/10.1002/sim.8291">Pilz <em>et al.</em>, 2019</a>. Instead, the <strong>adoptr</strong> package implements a direct numerical solution algorithm by embedding the variation problem via a set of pivot points in the <span class="math inline">\(\mathbb{R}^k\)</span> and solving the corresponding finite-dimensional problem using gradient-free numerical optimization procedures (COBYLA / nloptr).</p>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>Consider the two-arm case comparing two group means mean. Let <span class="math inline">\(\delta\)</span> be the difference in means and assume that the aim is to reject the null hypothesis <span class="math inline">\(\mathcal{H}_0: \delta \leq 0\)</span>. Further assume that a power of 80% at <span class="math inline">\(\delta=0.4\)</span> and a type-one-error rate of 2.5% on the boundary of the null hypothesis <span class="math inline">\(\delta\leq0.0\)</span> is required.</p>
<p>In this situation, the one-sided t-test would require a sample size of <span class="math inline">\(51\)</span> individuals per-group. If we were willing to accept the fact that the sample size of a two-stage design is inherently unknown at the planning stage, we could reduce the <em>expected</em> sample size under the alternative by optimizing a two-stage design with respect to this quantity. Since the two-stage design, by definition, has more degrees of freedom than the single-stage design, it must be at least as good in terms of expected sample size as the single-stage design - for which the expected sample size is always 51.</p>
<div id="define-hypotheses-and-data-generating-mechanism" class="section level2">
<h2 class="hasAnchor">
<a href="#define-hypotheses-and-data-generating-mechanism" class="anchor"></a>Define hypotheses and data-generating mechanism</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">adoptr</span>)</pre></body></html></div>
<p>First, we define the null and alternative hypotheses as prior distributions over the unknown parameter <span class="math inline">\(\delta\)</span>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">H_0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="fl">.0</span>, <span class="fl">1</span>)
<span class="no">H_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span>(<span class="fl">.4</span>, <span class="fl">1</span>)</pre></body></html></div>
<p>Next, we define the data-generating mechanism (data distribution). Currently, normally distributed test statistics with known variance, and the normal approximation of binary endpoints are supported. In this example, we choose a normal distribution, i.e., assume a continuous outcome. For an example with binomial data distribution, cf. the vignette <a href="https://kkmann.github.io/adoptr/articles/composite-scores.html">composite scores</a>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">datadist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span>(<span class="kw">two_armed</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
</div>
<div id="specify-optimization-problem" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-optimization-problem" class="anchor"></a>Specify optimization problem</h2>
<p>We begin by defining the expected sample size under the alternative hypothesis:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ess</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ExpectedSampleSize</a></span>(<span class="no">datadist</span>, <span class="no">H_1</span>)</pre></body></html></div>
<p>Similarly, we can define the power and the type-one-error rate by integrating conditional power with respect to the alternative or null hypothesis respectively:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">power</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span>(<span class="no">datadist</span>, <span class="no">H_1</span>)
<span class="no">toer</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span>(<span class="no">datadist</span>, <span class="no">H_0</span>)</pre></body></html></div>
<p>To complete the problem specification, we only need to provide an initial design and an integration order for the Gaussian quadrature rule to be used for the numerical integration of the variational objective between <span class="math inline">\(c_1^f\)</span> and <span class="math inline">\(c_1^e\)</span>. <strong>adoptr</strong> provides a heuristic method to obtain an initial design. It is based on a one-stage design under specific constraints on type one error rate and power. However, it may be more efficient to use a situation-specific initial design.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">initial_design</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_initial_design.html">get_initial_design</a></span>(
  <span class="kw">theta</span> <span class="kw">=</span> <span class="fl">.4</span>,
  <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.025</span>,
  <span class="kw">beta</span>  <span class="kw">=</span> <span class="fl">.2</span>,
  <span class="kw">type</span>  <span class="kw">=</span> <span class="st">"two-stage"</span>,
  <span class="kw">dist</span>  <span class="kw">=</span> <span class="no">datadist</span>,
  <span class="kw">order</span> <span class="kw">=</span> <span class="fl">7L</span>
)</pre></body></html></div>
<p>The decision boundaries are heuristically picked in concordance with those of the single-stage design. We can then check whether the initial design fulfills the constraints on the operating characteristics:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">power</span>, <span class="no">initial_design</span>)
<span class="co">#&gt; [1] 0.9401854</span></pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">toer</span>, <span class="no">initial_design</span>)
<span class="co">#&gt; [1] 0.0246875</span></pre></body></html></div>
<p>We can now proceed with defining and solving the optimization problem:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">opt_res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/minimize.html">minimize</a></span>(

  <span class="no">ess</span>,

  <span class="fu"><a href="../reference/subject_to.html">subject_to</a></span>(
    <span class="no">power</span> <span class="kw">&gt;=</span> <span class="fl">0.8</span>,
    <span class="no">toer</span>  <span class="kw">&lt;=</span> <span class="fl">.025</span>
  ),

  <span class="no">initial_design</span>
)</pre></body></html></div>
<p>Here, the default setting for the optimizer and box constraints seem to have worked out. The numerical procedure converged after</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">opt_res</span>$<span class="no">nloptr_return</span>$<span class="no">iterations</span></pre></body></html></div>
<p>iterations.</p>
<p>We can plot the resulting optimized design may again be plotted together with its conditional power.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="no">opt_res</span>$<span class="no">design</span>,
  <span class="st">"Conditional power"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span>(<span class="no">datadist</span>, <span class="no">H_1</span>)
)</pre></body></html></div>
<p><img src="adoptr_files/figure-html/plot-optimal-design-1.png" width="672"></p>
<p>Numerical integration yields an expected sample size of</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">ess</span>, <span class="no">opt_res</span>$<span class="no">design</span>)
<span class="co">#&gt; [1] 39.85583</span></pre></body></html></div>
<p>which is way below the single-stage 51. We can check this results against simulated values</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">df_sim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(
  <span class="no">opt_res</span>$<span class="no">design</span>,
  <span class="kw">nsim</span> <span class="kw">=</span> <span class="fl">10</span>^<span class="fl">6</span>,
  <span class="kw">dist</span> <span class="kw">=</span> <span class="no">datadist</span>,
  <span class="kw">theta</span> <span class="kw">=</span> <span class="fl">.4</span>,
  <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">42</span>
)

<span class="no">n</span> <span class="kw">&lt;-</span> <span class="no">df_sim</span>$<span class="no">n1</span> + <span class="no">df_sim</span>$<span class="no">n2</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">n</span>)
<span class="co">#&gt; [1] 39.83997</span>
<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">n</span>) / <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">n</span>))
<span class="co">#&gt; [1] 0.01372659</span></pre></body></html></div>
<p>The values from simulation and numerical integration are almost identical and the constraints are also met almost perfectly:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">toer</span>, <span class="no">opt_res</span>$<span class="no">design</span>)
<span class="co">#&gt; [1] 0.02500571</span>
<span class="fu"><a href="../reference/Scores.html">evaluate</a></span>(<span class="no">power</span>, <span class="no">opt_res</span>$<span class="no">design</span>)
<span class="co">#&gt; [1] 0.7985318</span></pre></body></html></div>
</div>
<div id="variations" class="section level2">
<h2 class="hasAnchor">
<a href="#variations" class="anchor"></a>Variations</h2>
<p>The purpose of <strong>adoptr</strong> is to provide a high-level interface for exploring and comparing different designs and to experiment with different combinations of objective functions and constraints. In particular, <strong>adoptr</strong> supports:</p>
<ul>
<li><p>Important predefined scores as (conditional) power or sample size functions as well as a framework for constraints on scores (cf. <a href="https://kkmann.github.io/adoptr/articles/conditional-scores.html">conditional scores</a>).</p></li>
<li><p>Arbitrary continuous or discrete <a href="https://kkmann.github.io/adoptr/articles/working-with-priors.html">prior distributions</a> for the single location parameter <span class="math inline">\(\theta\)</span> of the test statistic.</p></li>
<li><p>Support for simple arithmetic operations on scores to quickly define weighted sums etc. (cf. <a href="https://kkmann.github.io/adoptr/articles/composite-scores.html">composite scores</a>).</p></li>
<li><p>Relatively flexible framework for <a href="https://kkmann.github.io/adoptr/articles/defining-new-scores.html">defining new scores</a>.</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin Kunzmann, Maximilian Pilz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f5b8253ef131d8de31a2e0e075678ba8',
    indexName: 'adoptr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
